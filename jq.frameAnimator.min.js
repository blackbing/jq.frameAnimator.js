/*
* Description: 那些年，回到過去特效文字
* Author: blackbing@gmail.com
* Example: $('#year').scrollEffectNumbers({
                initNumber: 2011,
                targetNumber: 1980,
                duration: 3000});
*/(function(a){function c(a,b,c){while(a.length<c)a=b+a;return a}var b=function(b){var d=this,e=a.extend({},{path:"./0-9Nova-Mono-cursive.png",initNumber:0,targetNumber:9,ease:function(a,b,c,d){return c*a/d+b},currentPos:{x:0,y:0},duration:1e3,timespan:30,updatedCallback:null},b),f=function(a){a=+a;var b=e.width,c=e.height,d=0;return c*a},g=function(a){var b=i(),d=c(a.toString(),"0",b),g=[];for(var j=0;j<d.length;j++){var k=f(d.substring(j,j+1)),l=e.width*j;g.push({x:l,y:k})}h(g)},h=function(a){l.clearRect(0,0,e.canvas.width,e.canvas.height),l.save(),e.transform&&e.transform(l);var b=i(),c,d;for(var f=0;f<a.length;f++){d=a[f].y;var g=e.image.height-e.height;d%=g,d=(d+g)%g,c=e.width*f,l.drawImage(e.image,0,d,e.width,e.height,c,0,e.width,e.height)}l.restore()},i=function(){var a=Math.max(e.initNumber,e.targetNumber),b=a.toString().length;return b},j=e.$elm,k=document.createElement("canvas"),l;!k.getContext&&typeof G_vmlCanvasManager!="undefined"&&(k=G_vmlCanvasManager.initElement(k),k.width=0,k.height=0,k.style.display="none"),k.getContext&&(l=k.getContext("2d"),l.lineCap="round",l.lineJoin="round"),j.appendChild(k);var m=new Image,n=!1;m.onload=function(){var b=i();e.width=m.width,e.height=Math.round(m.height/11),k.width=e.width*b,k.height=e.height,e.canvas=k,e.image=m,g(e.initNumber),k.style.display="",n=!0,a(e.$elm).show()},m.src=e.path,this.getOption=function(){return e},this.updateOption=function(b){e=a.extend(e,b)},this.add=function(a){var b=e.initNumber+a;this.go({targetNumber:b})},this.go=function(a){if(!n){var b=arguments,d=arguments.callee,g=this;return setTimeout(function(){d.apply(g,b)},10)}a&&a.targetNumber&&(e.targetNumber=a.targetNumber);var i=[],j=Math.max(e.initNumber,e.targetNumber),k=j.toString().length,l=c(e.initNumber.toString(),"0",k),m=c(e.targetNumber.toString(),"0",k);for(var o=0;o<k;o++){var p={};p.initNumber=parseInt(e.initNumber.toString().substring(0,o+1),10),p.targetNumber=parseInt(e.targetNumber.toString().substring(0,o+1),10),p.initPos=f(p.initNumber),p.targetPos=f(p.targetNumber),p.delta=p.targetPos-p.initPos,i.push(p)}var q=0,r=e.duration,s=+(new Date),t=e.timespan,u=i[i.length-1].initPos,v=i[i.length-1].targetPos;e.interval=setInterval(function(){var a=[];for(var b=0;b<i.length;b++){var c=i[b],d=e.ease(q,c.initPos,c.delta,r);a.push({x:e.width*b,y:d})}if((u-v)*(a[a.length-1].y-v)<=0){clearInterval(e.interval),e.initNumber=e.targetNumber;var f=+(new Date)}h(a),q+=t,u=a[a.length-1].y},t)}};a.fn.frameAnimator=function(a){this.empty().hide(),a.$elm=this.get(0);var c=new b(a);c.go()}})(jQuery);